!function(a){"use strict";a.module("user_management.avatar",[])}(window.angular),function(a){"use strict";var b=a.module("user_management.avatar");b.provider("userManagementAvatarConfig",function(){var a="",b="/profile/avatar",c={"default":"/avatars/avatar-default.png"};return{$get:function(){return{apiRoot:function(){return a},avatarEndpoint:function(){return b},defaultAvatarPaths:function(){return c}}},setApiRoot:function(b){a=b},setAvatarEndpoint:function(a){b=a},setDefaultAvatarPaths:function(a){c=a}}})}(window.angular),function(a){"use strict";var b=a.module("user_management.avatar");b.factory("avatarFactory",["$http","userManagementAvatarConfig",function(b,c){var d=c.apiRoot(),e={url:d+c.avatarEndpoint(),load:function(c){return c=a.extend({},{method:"GET"},c),b(c)},clear:function(a){return b.delete(a)}};return e}])}(window.angular),function(a){"use strict";var b=a.module("user_management.avatar");b.directive("modifyAction",[function(){return{restrict:"A",link:function(b,c,d){function e(b){a.isDefined(b)&&""!==b&&(c[0].action=b)}d.$observe("modifyAction",function(){e(d.modifyAction)})}}}]),b.directive("autoSubmit",[function(){return{restrict:"A",scope:{formId:"@"},link:function(a,b){function c(){try{document.getElementById(a.formId).submit()}catch(b){}}b[0].onchange=c}}}]),b.directive("avatarProfileForm",["$rootScope","userManagementAvatarConfig","avatarFactory","$location",function(a,b,c,d){return{restrict:"A",link:function(e){function f(a){e.$broadcast("avatar:clear:success",a)}function g(a){e.$broadcast("avatar:clear:error",a)}function h(a){a.stopPropagation(),c.clear(e.avatarUploadUrl).then(f,g)}var i=b.apiRoot();e.avatarUploadUrl=i+b.avatarEndpoint(),e.token=a.userToken,e.absUrl=d.$$absUrl,e.clearAvatar=h}}}]),b.directive("avatar",["$rootScope","profileFactory","avatarFactory","userManagementAvatarConfig",function(b,c,d,e){return{restrict:"A",scope:{userUrl:"@"},link:function(b,c,f){function g(b){d.load({url:b,params:{width:k,height:l}}).then(function(b){var d=b.data;c[0].src=a.isDefined(d.avatar)?d.avatar:j.default},function(){c[0].src=j.default})}function h(){g(b.userUrl)}var i=e.apiRoot(),j=i+e.defaultAvatarPaths(),k=f.width,l=f.height;a.isDefined(f.imageWidth)&&(k=f.imageWidth),a.isDefined(f.imageHeight)&&(l=f.imageHeight),b.$watch("userUrl",function(){b.userUrl=f.userUrl,a.isDefined(b.userUrl)&&null!==b.userUrl&&""!==b.userUrl&&g(b.userUrl)}),b.$on("avatar:clear:success",h),b.$on("avatar:clear:error",h)}}}])}(window.angular);
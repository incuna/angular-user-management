!function(a){"use strict";a.module("user_management.avatar",[])}(window.angular),function(a){"use strict";var b=a.module("user_management.avatar");b.provider("userManagementAvatarConfig",function(){var a="",b="/profile/avatar",c={"300x300":"/avatars/avatar-300.png"};return{$get:function(){return{apiRoot:function(){return a},avatarEndpoint:function(){return b},defaultAvatarPaths:function(){return c}}},setApiRoot:function(b){a=b},setAvatarEndpoint:function(a){b=a},setDefaultAvatarPaths:function(a){c=a}}})}(window.angular),function(a){"use strict";var b=a.module("user_management.avatar");b.factory("avatarFactory",["$http","userManagementAvatarConfig",function(a,b){var c=b.apiRoot(),d={url:c+b.avatarEndpoint(),load:function(b){return a({method:"GET",url:b})},getSized:function(b){return a({method:"GET",url:b.path,params:{width:b.width,height:b.height}})},clear:function(b){return a({method:"DELETE",url:b})}};return d}])}(window.angular),function(a){"use strict";var b=a.module("user_management.avatar");b.directive("modifyAction",[function(){return{restrict:"A",link:function(b,c,d){function e(b){a.isDefined(b)&&""!==b&&(c[0].action=b)}b.$watch("modifyAction",function(){e(d.modifyAction)})}}}]),b.directive("autoSubmit",[function(){return{restrict:"A",scope:{formId:"@"},link:function(a,b){function c(){try{document.getElementById(a.formId).submit()}catch(b){}}b[0].onchange=c}}}]),b.directive("avatarprofileInit",["userManagementAvatarConfig","$rootScope","avatarFactory",function(a,b,c){return{restrict:"A",link:function(d){function e(a){d.$broadcast("avatar:clear:success",a)}function f(a){d.$broadcast("avatar:clear:error",a)}function g(a){a.stopPropagation(),c.clear(d.avatarUploadUrl).then(e,f)}var h=a.apiRoot();d.avatarUploadUrl=h+a.avatarEndpoint(),d.token=b.usertoken,d.clearAvatar=g}}}]),b.directive("avatar",["$rootScope","$timeout","$http","profileFactory","avatarFactory","userManagementAvatarConfig",function(b,c,d,e,f,g){return{restrict:"A",scope:{userUrl:"@",size:"@"},link:function(b,c,d){function e(b){f.getSized({path:b,width:k,height:l}).then(function(b){var d=b.data;c[0].src=a.isDefined(d.avatar)?d.avatar:j.thumbnail},function(){c[0].src=j.thumbnail})}function h(){e(b.userUrl)}var i=g.apiRoot(),j=i+g.defaultAvatarPaths(),k=d.width,l=d.height;a.isDefined(d.imagewidth)&&(k=d.imagewidth),a.isDefined(d.imageheight)&&(l=d.imageheight),b.$watch("userUrl",function(){b.userUrl=d.userUrl,a.isDefined(b.userUrl)&&null!==b.userUrl&&""!==b.userUrl&&e(b.userUrl)}),b.$on("avatar:clear:success",h),b.$on("avatar:clear:error",h)}}}])}(window.angular);